// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

 enum ROLE {
  ADMIN
  USER
}
enum DIFFICULTY {
  EASY 
  MEDIUM
  HARD
}


model user {
  id String @id @default(uuid())
  name String   
  email String @unique
  password String
  role ROLE
  createdAt DateTime @default(now())
  problems problem[]
  submission submission[]
  refreshtoken RefreshToken[]
}
 model RefreshToken {
  id String @id @default(uuid())
  userId String
  user user @relation(fields: [userId],references: [id])
  role ROLE
  token String
  expiresAt DateTime
 }
model problem {
  id String @id @default(uuid())
  title String
  decription String
  difficulty DIFFICULTY
  tags String[]
  timeLimit Float
  memoryLimit Float
  createdBy user @relation(fields: [userId],references: [id])
  userId String
  createdAt DateTime @default(now())
  visible_testcases visible_testcases[]
  hidden_testcases hidden_testcases[]
  submission submission[]
}
 
 model visible_testcases {
   id String @id @default(uuid())
   inputPath String
   outputPath String
  problem problem @relation(fields: [problemId],references: [id])
  problemId String
  createdAt DateTime @default(now())
 }
model hidden_testcases {
  id String @id @default(uuid())
  inputPath String
   outputPath String
  problem problem @relation(fields: [problemId],references: [id])
  problemId String
  createdAt DateTime @default(now())
}

enum STATUS {
  PENDING
  RUNNING
  AC
  WA
  TLE
  RE
}
enum LANGUAGE {
  java 
  cpp
  python
}
model submission {
  id String @id @default(uuid())
  user user @relation(fields: [userId],references: [id])
  userId String
  problem problem @relation(fields: [problemId],references: [id])
  problemId String
  language LANGUAGE
  codePath String
  status STATUS @default(PENDING)
  runtime Int
  memory Int
  createdAt DateTime @default(now())
  submission_result submission_result[]
}

model submission_result {
   id String @id @default(uuid())
   submission submission @relation(fields: [submissionId],references: [id])
   submissionId String
   testCaseIndex Int
   is_hidden Boolean
   inputPath String
   outputPath String
    user_output String?
    stdout String?
    stderr String?
    time_ms Float?
    memory_kb Float?
    verdict STATUS
    createdAt DateTime @default(now())
}